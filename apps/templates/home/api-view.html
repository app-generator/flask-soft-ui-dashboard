{% extends 'layouts/base.html' %}

{% block title %} Chatbot UI {% endblock title %}

{% block stylesheets %}
  <!-- Specific CSS goes HERE -->
  <link rel="stylesheet" href="{{ config.ASSETS_ROOT }}/css/chatbot.css">
{% endblock stylesheets %}

{% block content %}

  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10">
        <div class="card mt-4">
          <div class="card-header">
            <h5 class="card-title mb-0">JuriAI - Chat</h5>
          </div>
          <div class="card-body">
            <div class="chat-container">
              <div class="chat-header">
                <img src="{{ config.ASSETS_ROOT }}/img/chatbot-icon.png" alt="Chatbot Icon">
                <h5>Juri AI</h5>
              </div>
              <div class="chat-body" style="max-height: 400px; overflow-y: scroll;">
                <ul class="chat-list">
                  <li class="chat-message bot-message">
                    <p>Hello! How can I assist you?</p>
                  </li>
                </ul>
              </div>
              <div class="chat-footer">
                <form id="chat-form">
                  <div class="input-group">
                    <input type="text" id="chat-input" class="form-control" placeholder="Type your message...">
                    <button type="submit" class="btn btn-primary">Send</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

{% endblock content %}

{% block javascripts %}
  <script>
    const chatForm = document.querySelector('#chat-form');
    const chatInput = document.querySelector('#chat-input');
    const chatList = document.querySelector('.chat-list');

    // Add event listener to chat form
chatForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const message = chatInput.value;
  // Add user message to chat list
  chatList.innerHTML += `
    <li class="chat-message user-message">
      <p>${message}</p>
    </li>
  `;
  // Clear chat input
  chatInput.value = '';
  // Show loading indicator
  chatList.innerHTML += `
    <li class="chat-message bot-message">
      <p class="loading">...</p>
    </li>
  `;
  // Send message to bot
  fetch('/endpoint', {
    method: 'POST',
    body: JSON.stringify({query: message}),
    headers: {'Content-Type': 'application/json'}
  })
  .then(response => response.json())
  .then(data => {
    // Remove loading indicator
    chatList.querySelector('.loading').remove();
    // Display bot response
    chatList.innerHTML += `
      <li class="chat-message bot-message">
        <p>${data.answer}</p>
      </li>
    `;
  })
  .catch(error => console.error(error));
});
  </script>
{% endblock javascripts %}

